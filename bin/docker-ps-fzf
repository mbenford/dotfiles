#!/usr/bin/env bash
set -e

container_id=`
	docker ps --format "table {{.ID}}\t{{.Names}}\t{{truncate .Image 50}}\t{{.Status}}\t{{.Ports}}" \
	| fzf \
	--header-lines=1 \
	--preview 'docker inspect {1}' \
	| awk '{print $1}'
`

[[ -z "$container_id" ]] && exit 1

actions=(
	"Kill"
	"Shell"
	"Copy ID"
)

action=`printf "%s\n" "${actions[@]}" | fzf --height=$((${#actions[@]} + 1))`
[[ -z "$action" ]] && exit 1

case $action in
	Kill)
		docker kill $container_id
		;;
	Shell)
		docker exec -it $container_id /bin/bash
		;;
	"Copy ID")
		printf $container_id | xclip -in -selection clipboard
		;;
	*)
		echo "unknow action"
		exit 1
esac

exit 0
