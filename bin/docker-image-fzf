#!/usr/bin/env bash
set -e

image_id=`
	docker image ls --format "table {{.ID}}\t{{.Repository}}\t{{.Tag}}\t{{.CreatedSince}}\t{{.Size}}\t" \
	| fzf \
	--header-lines=1 \
	--preview 'docker inspect {1}' \
	| awk '{print $1}'
`
[[ -z "$image_id" ]] && exit 1

actions=(
	"Delete"
	"Run"
	"Shell"
	"Copy ID"
)

action=`printf "%s\n" "${actions[@]}" | fzf --height=$((${#actions[@]} + 1))`
[[ -z "$action" ]] && exit 1

case $action in
	Delete)
		docker image rm -f $image_id
		;;
	Run)
		docker run $image_id
		;;
	Shell)
		docker run -it --rm $image_id /bin/bash
		;;
	"Copy ID")
		printf $image_id | xclip -in -selection clipboard
		;;
	*)
		echo "unknow action"
		exit 1
esac

exit 0
