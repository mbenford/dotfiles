#!/usr/bin/env bash

set -e

[[ -z "$TERMINAL" ]] && { >&2 echo "TERMINAL not set"; exit 1; }
[[ -z "$EDITOR" ]] && { >&2 echo "EDITOR not set"; exit 1; }

basedir=$HOME/.dotfiles
files=($(find $basedir -mindepth 2 -path $basedir/.git -prune -o -type f -print | sort))

selected=$(printf '%s\n' "${files[@]#${basedir}/}" | rofi -dmenu -p dotfiles -format i -no-custom)
file=${files[selected]}

cd $(dirname $file)
$TERMINAL $EDITOR $file
