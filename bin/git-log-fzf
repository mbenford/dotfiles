#!/usr/bin/env bash

set -e

hash=$(
	git \
	--no-pager log -100 \
	--pretty='%C(yellow)%h%Creset %C(bold blue)%<(15,trunc)%ae%Creset%C(auto)%d%Creset %s %Cgreen(%cr)' \
	| fzf \
	--ansi \
	--preview 'git show --name-status {1}' \
	--preview-window hidden \
	--bind 'ctrl-p:toggle-preview' \
	| awk '{printf $1}')

[[ -z "$hash" ]] && exit 1

actions=(
	"Copy"
	"Show"
	"Checkout"
	"Rebase"
)
action=$(printf "%s\n" "${actions[@]}" | fzf --height=$((${#actions[@]} + 1)))
[[ -z "$action" ]] && exit 1

case $action in
	Copy)
		printf $hash | xclip -in -selection clipboard
		;;
	Show)
		git show $hash
		;;
	Checkout)
		git checkout $hash
		;;
	Rebase)
		git rebase -i $hash
		;;
	*)
		echo "unknow action"
		exit 1
esac

exit 0
