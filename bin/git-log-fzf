#!/usr/bin/env bash

set -e

hash=$(
	git \
	--no-pager log -100 \
	--pretty='%C(yellow)%h%Creset %C(bold blue)%<(15,trunc)%ae%Creset %Cgreen%cs %C(auto)%d%Creset %s' \
	--color=always \
	| fzf \
	--height=60% \
	--ansi \
	--preview 'git show --name-status {1}' \
	--preview-window down,40%,border-sharp,hidden \
	--bind 'ctrl-p:toggle-preview' \
	| awk '{printf $1}'
)

[[ -z "$hash" ]] && exit 1

actions=(
	"Copy"
	"Checkout"
	"Fix up"
	"Rebase"
	"Reset"
	"Show"
)
action=$(printf "%s\n" "${actions[@]}" | fzf --height=$((${#actions[@]} + 1)))
[[ -z "$action" ]] && exit 1

case $action in
	Copy)
		printf $hash | xclip -in -selection clipboard
		;;
	Checkout)
		git checkout $hash
		;;
	"Fix up")
		git commit --fixup $hash
		;;
	Rebase)
		git rebase -i $hash
		;;
	Reset)
		git reset --soft $hash
		;;
	Show)
		git show $hash
		;;
	*)
		echo "unknow action"
		exit 1
esac

exit 0
